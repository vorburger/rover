<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Rover</title>

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>

  <script>
    "use strict";
/*
    setInterval(clock, 1000);
    function clock() {
      document.getElementById("clock").innerHTML = new Date().toLocaleTimeString();
	}
*/
    var http = new XMLHttpRequest();
    var reNotifyTime = 200;
    var interval;
  
    function mouseDown(button) {
      clearGlobalInterval();
      interval = setInterval(newNotifyStillDownFunction(button), reNotifyTime);
    }

    function clearGlobalInterval() {
      if (typeof interval !== 'undefined') {
        clearInterval(interval);
        interval = undefined;
      }
    }

    // Up is sometimes called twice, with no down
    function mouseUp(button) {
      clearGlobalInterval();
      console.log("up " + button);
      http.open("GET", "/button?name=" + button + "&up=true", true);
      http.send(null);
    }
    
    function newNotifyStillDownFunction(button) {
      return function() {
        console.log("down " + button);
        http.open("GET", "/button?name=" + button + "&time=" + reNotifyTime, true);
        http.send(null);
      }
    }
  </script>

  <p><div onmousedown="mouseDown('forward')" onmouseup="mouseUp('forward')">&uArr;</div>
  <p><div onmousedown="mouseDown('right')" onmouseup="mouseUp('right')">&#x21B1;</div> <!-- 21BB -->
  <p><div onmousedown="mouseDown('left')" onmouseup="mouseUp('left')">&#x21B0;</div> <!-- 21BA -->
  <p><div onmousedown="mouseDown('back')" onmouseup="mouseUp('back')">&dArr;</div>

<!--
  <img src="images/mars-rover-landing-nasa.gif">
  <img src="images/mars-rover-rolling.gif">
  <img src="images/mars-rover-cat.gif">

  <p><div id="clock">CLOCK</div>
 -->
</body>
</html>
